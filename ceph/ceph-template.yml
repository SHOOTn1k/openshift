apiVersion: template.openshift.io/v1
kind: Template
labels:
  redis: master
metadata:
  annotations:
    description: Description
    tags: ceph
  creationTimestamp: null
  name: ceph-template
objects:
- apiVersion: rbac.authorization.k8s.io/v1beta1
  kind: ClusterRoleBinding
  metadata:
    name: ${PROJECT_NAME}-ceph-cluster-admin
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: ClusterRole
    name: cluster-admin
  subjects:
  - kind: ServiceAccount
    name: internal-cluster-admin
    namespace: ${PROJECT_NAME}
- apiVersion: v1
  kind: ServiceAccount
  metadata:
    name: rook-ceph-osd
- apiVersion: v1
  kind: ServiceAccount
  metadata:
    name: rook-ceph-mgr
- apiVersion: v1
  kind: ServiceAccount
  metadata:
    name: rook-ceph-cmd-reporter
- kind: Role
  apiVersion: rbac.authorization.k8s.io/v1beta1
  metadata:
    name: rook-ceph-osd
  rules:
  - apiGroups: [""]
    resources: ["configmaps"]
    verbs: [ "get", "list", "watch", "create", "update", "delete" ]
  - apiGroups: ["ceph.rook.io"]
    resources: ["cephclusters", "cephclusters/finalizers"]
    verbs: [ "get", "list", "create", "update", "delete" ]
- kind: Role
  apiVersion: rbac.authorization.k8s.io/v1beta1
  metadata:
    name: rook-ceph-mgr
  rules:
  - apiGroups:
    - ""
    resources:
    - pods
    - services
    verbs:
    - get
    - list
    - watch
  - apiGroups:
    - batch
    resources:
    - jobs
    verbs:
    - get
    - list
    - watch
    - create
    - update
    - delete
  - apiGroups:
    - ceph.rook.io
    resources:
    - "*"
    verbs:
    - "*"
- kind: Role
  apiVersion: rbac.authorization.k8s.io/v1beta1
  metadata:
    name: rook-ceph-cmd-reporter
  rules:
  - apiGroups:
    - ""
    resources:
    - pods
    - configmaps
    verbs:
    - get
    - list
    - watch
    - create
    - update
    - delete
- kind: RoleBinding
  apiVersion: rbac.authorization.k8s.io/v1beta1
  metadata:
    name: rook-ceph-cluster-mgmt
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: ClusterRole
    name: rook-ceph-cluster-mgmt
  subjects:
  - kind: ServiceAccount
    name: rook-ceph-system
    namespace: rook-ceph
- kind: RoleBinding
  apiVersion: rbac.authorization.k8s.io/v1beta1
  metadata:
    name: rook-ceph-cluster-mgmt-psp
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: ClusterRole
    name: psp:rook
  subjects:
  - kind: ServiceAccount
    name: rook-ceph-system
    namespace: rook-ceph
- kind: RoleBinding
  apiVersion: rbac.authorization.k8s.io/v1beta1
  metadata:
    name: rook-ceph-osd
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: Role
    name: rook-ceph-osd
  subjects:
  - kind: ServiceAccount
    name: rook-ceph-osd
    namespace: ${PROJECT_NAME}
- kind: RoleBinding
  apiVersion: rbac.authorization.k8s.io/v1beta1
  metadata:
    name: rook-ceph-mgr
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: Role
    name: rook-ceph-mgr
  subjects:
  - kind: ServiceAccount
    name: rook-ceph-mgr
    namespace: ${PROJECT_NAME}
- kind: RoleBinding
  apiVersion: rbac.authorization.k8s.io/v1beta1
  metadata:
    name: rook-ceph-cmd-reporter
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: Role
    name: rook-ceph-cmd-reporter
  subjects:
  - kind: ServiceAccount
    name: rook-ceph-cmd-reporter
    namespace: ${PROJECT_NAME}
- apiVersion: rbac.authorization.k8s.io/v1
  kind: RoleBinding
  metadata:
    name: rook-ceph-default-psp
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: ClusterRole
    name: psp:rook
  subjects:
  - kind: ServiceAccount
    name: default
    namespace: ${PROJECT_NAME}
- apiVersion: rbac.authorization.k8s.io/v1
  kind: RoleBinding
  metadata:
    name: rook-ceph-osd-psp
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: ClusterRole
    name: psp:rook
  subjects:
  - kind: ServiceAccount
    name: rook-ceph-osd
    namespace: ${PROJECT_NAME}
- apiVersion: rbac.authorization.k8s.io/v1
  kind: RoleBinding
  metadata:
    name: rook-ceph-mgr-psp
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: ClusterRole
    name: psp:rook
  subjects:
  - kind: ServiceAccount
    name: rook-ceph-mgr
    namespace: ${PROJECT_NAME}
- apiVersion: rbac.authorization.k8s.io/v1
  kind: RoleBinding
  metadata:
    name: rook-ceph-cmd-reporter-psp
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: ClusterRole
    name: psp:rook
  subjects:
  - kind: ServiceAccount
    name: rook-ceph-cmd-reporter
    namespace: ${PROJECT_NAME}
- apiVersion: v1
  kind: ServiceAccount
  metadata:
    name: rook-csi-cephfs-plugin-sa
- apiVersion: v1
  kind: ServiceAccount
  metadata:
    name: rook-csi-cephfs-provisioner-sa
- kind: Role
  apiVersion: rbac.authorization.k8s.io/v1
  metadata:
    name: cephfs-external-provisioner-cfg
  rules:
    - apiGroups: [""]
      resources: ["endpoints"]
      verbs: ["get", "watch", "list", "delete", "update", "create"]
    - apiGroups: [""]
      resources: ["configmaps"]
      verbs: ["get", "list", "create", "delete"]
    - apiGroups: ["coordination.k8s.io"]
      resources: ["leases"]
      verbs: ["get", "watch", "list", "delete", "update", "create"]
- kind: RoleBinding
  apiVersion: rbac.authorization.k8s.io/v1
  metadata:
    name: cephfs-csi-provisioner-role-cfg
  subjects:
    - kind: ServiceAccount
      name: rook-csi-cephfs-provisioner-sa
      namespace: ${PROJECT_NAME}
  roleRef:
    kind: Role
    name: cephfs-external-provisioner-cfg
    apiGroup: rbac.authorization.k8s.io
- apiVersion: v1
  kind: ServiceAccount
  metadata:
    name: rook-csi-rbd-plugin-sa
- apiVersion: v1
  kind: ServiceAccount
  metadata:
    name: rook-csi-rbd-provisioner-sa
- kind: Role
  apiVersion: rbac.authorization.k8s.io/v1
  metadata:
    name: rbd-external-provisioner-cfg
  rules:
    - apiGroups: [""]
      resources: ["endpoints"]
      verbs: ["get", "watch", "list", "delete", "update", "create"]
    - apiGroups: [""]
      resources: ["configmaps"]
      verbs: ["get", "list", "watch", "create", "delete"]
    - apiGroups: ["coordination.k8s.io"]
      resources: ["leases"]
      verbs: ["get", "watch", "list", "delete", "update", "create"]
- kind: RoleBinding
  apiVersion: rbac.authorization.k8s.io/v1
  metadata:
    name: rbd-csi-provisioner-role-cfg
  subjects:
    - kind: ServiceAccount
      name: rook-csi-rbd-provisioner-sa
      namespace: ${PROJECT_NAME}
  roleRef:
    kind: Role
    name: rbd-external-provisioner-cfg
    apiGroup: rbac.authorization.k8s.io
parameters:
- description: Project where CephCluster will be deployed
  value: ceph
  name: PROJECT_NAME